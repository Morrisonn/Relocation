{% extends 'main/hr/base.html' %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
{% load bootstrap4 %}
{% bootstrap_css %}
{% bootstrap_javascript %}
{% block userPage %}

<div class="template-div">

    <style>
        #employee_profile{
            text-align: center;
            font-size: 24px;
            font-style: bold !important;
        }
        h1 {
            position: absolute;
            top: 40%;
            left: 220;
            width: 100%;
        }
        .content-div{
        width: 1536px;
        height: 633px;
    
        .nav-item{
          margin-left: 100px;
            margin-right: 100px;
            margin-top: 15px;
            pointer-events: none;
        }
        .nav-link {
          border-radius: 50%;
          width: 45px;
          height: 45px;
          line-height: 30px;
          text-align: center;
        }
        .container{
          width: 2000px;
        }
        .progress {
        position: relative;
        }
    }
    </style>

    <!-- <style>
        
        h4{
            text-align: center;
        }
        .alert.alert-info {
        color: #fff;
        background-color: #fff;
        border-color: #fff;
        }
        
    </style> -->
    <div style="width: 300px !important; height: 200px !important;">
      <div id="myTabContent" class="tab-content" >
        <hr>
        <!-- <div class="tab-pane fade active in" id="detail"> -->
        <h3 id="employee_profile">Профиль сотрудника</h3>
        <table class="table">
        <tbody>
        <tr><td class="active">Имя:</td><td>{{personal_info.0.first_name}}</td></tr>
        <tr><td class="active">Фамилия:</td><td>{{personal_info.0.last_name}}</td></tr>
        <tr><td class="active">Отчество:</td><td>{{personal_info.0.middle_name}}</td></tr>
        <tr><td class="active">Пол:</td><td>
            
            {% if personal_info.0.gender == "male" %}
                мужской
            {% else %}
                женский
            {%endif%}
            </td></tr>
        <tr><td class="active">Дата рождения:</td><td>{{personal_info.0.date_of_birth}}</td></tr>
        <tr><td class="active">Стаж работы:</td><td>{{personal_info.0.work_experience}}</td></tr>
        <tr><td class="active">Доджность:</td><td>{{personal_info.0.position}}</td></tr>
        <tr><td class="active">Ставка:</td><td>{{personal_info.0.rate}}</td></tr>
        <tr><td class="active">Адрес электронной почты:</td><td>{{personal_info.0.email}}</td></tr>
        <tr><td class="active">Номер телефона:</td><td>{{personal_info.0.phone_number}}</td></tr>
        </tbody>
        </table>
        <!-- <ul id="myTab" class="nav nav-pills">
            <li id="btn1"><a href="#contact" data-toggle="tab">Редактировать</a></li>
        </ul> -->
        <!-- </div> -->
        <div class="tab-pane fade" id="contact">
        <p></p>
        </div>
      </div>
    </div>
    <div class="container">
		<div class="row">
		  <div class="col-md-12" >
			<ul class="nav nav-pills mb-3 justify-content-center" id="pills-tab" role="tablist">
			  <li class="nav-item" role="presentation">
				<a class="nav-link" id="pills-step1-tab" data-toggle="pill" href="#pills-step1" role="tab" aria-controls="pills-step1" aria-selected="true">1</a>
			  </li>
			  <li class="nav-item" role="presentation">
				<a class="nav-link" id="pills-step2-tab" data-toggle="pill" href="#pills-step2" role="tab" aria-controls="pills-step2" aria-selected="false">2</a>
			  </li>
			  <li class="nav-item" role="presentation">
				<a class="nav-link" id="pills-step3-tab" data-toggle="pill" href="#pills-step3" role="tab" aria-controls="pills-step3" aria-selected="false">3</a>
			  </li>
        <li class="nav-item" role="presentation">
          <a class="nav-link" id="pills-step4-tab" data-toggle="pill" href="#pills-step3" role="tab" aria-controls="pills-step3" aria-selected="false">4</a>
        </li>
			</ul>
			<div class="progress mb-3">
			  <div class="progress-bar progress-bar-striped" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
			</div>
			<div class="tab-content" id="pills-tabContent">
			  <div class="tab-pane fade show active" id="pills-step1" role="tabpanel" aria-labelledby="pills-step1-tab">
				
			  </div>
			  <div class="tab-pane fade" id="pills-step2" role="tabpanel" aria-labelledby="pills-step2-tab">
				
			  </div>
			  <div class="tab-pane fade" id="pills-step3" role="tabpanel" aria-labelledby="pills-step3-tab">
				
			  </div>
			</div>
		  </div>
		</div>
    <p>1. Заявка отправлена</p>
    <p>2. Назначено собеседование</p>
    <p>3. Собеседование пройдено. Ожидание документов</p>
    <p>4. Релокация завершена</p>
	  </div>

    <script>
		document.addEventListener("DOMContentLoaded", function(event) {
		var status = "{{ status }}";
		var progressBar = document.querySelector(".progress-bar");
		
		if (status == "first") {
			progressBar.style.width = "25%";
			progressBar.setAttribute("aria-valuenow", "25" );
			document.querySelector("#pills-step1-tab").classList.add("active");
		} else if (status == "second") {
			progressBar.style.width = "50%";
			progressBar.setAttribute("aria-valuenow", "50");
			document.querySelector("#pills-step2-tab").classList.add("active");
		} else if (status == "third") {
			progressBar.style.width = "75%";
			progressBar.setAttribute("aria-valuenow", "75");
			document.querySelector("#pills-step3-tab").classList.add("active");
		}
    else if (status == "fourt") {
			progressBar.style.width = "100%";
			progressBar.setAttribute("aria-valuenow", "100");
			document.querySelector("#pills-step4-tab").classList.add("active");
		}
		});
	  </script>
        <div>
          {% if user_application.status == "first" or user_application.status == "second" %}
            <script src="https://meet.jit.si/external_api.js"></script>
            <div id="jitsi-container" style="margin-top: 30px; margin-right: 30px;"></div>
            <script>
              const domain = 'meet.jit.si';
              const userName = 'София';
              const options = {
                roomName: generateUniqueRoomName(),
                width: 800,
                height: 500,
                parentNode: document.querySelector('#jitsi-container'),
                configOverwrite: {
                  defaultLanguage: 'ru',
                },
                interfaceConfigOverwrite: {
                  DEFAULT_LANGUAGE: 'ru',
                  LANG_DETECTION: true,
                  LANGUAGES: {
                    ru: 'Русский',
                  },
                },
              };

              const api = new JitsiMeetExternalAPI(domain, options);
              // Функция для генерации уникального идентификатора встречи
              function generateUniqueRoomName() {
                // В данном примере используется текущая дата и случайное число
                const firstName = "София";
                const timestamp = Date.now();
                const random = Math.floor(Math.random() * 10000);
                // return `meeting-${timestamp}-${random}`;
                return `${firstName}-meeting-${timestamp}-${random}`
              }
              // const meetingURL = api.getMeetingURL();
              // alert(`URL встречи: ${meetingURL}`);

              const exitButton = document.querySelector('#exit-button');
              exitButton.addEventListener('click', () => {
                api.dispose();
              });
              // console.log('URL встречи:', meetingURL);

              api.addEventListener('ready', () => {
                // Получение URL встречи
                const meetingURL = api.getMeetingURL();
                console.log('URL встречи:', meetingURL);

                const meetingLink = document.createElement('a');
                meetingLink.href = meetingURL;
                meetingLink.textContent = 'Ссылка на встречу';
                document.body.appendChild(meetingLink);
              });
            </script>
            <!-- <script>
              const domain = 'meet.jit.si';
              const options = {
                roomName: 'your-room-name',
                width: 800,
                height: 600,
                parentNode: document.querySelector('#jitsi-container'),
              };
              const api = new JitsiMeetExternalAPI(domain, options);
            </script> -->
            {% if user_application.status == "first" %}
              <form method="post" class="first_form" style="text-align: center; margin-top: 10px;">
                {% csrf_token %}
                {{ form.as_p }}
                <div class="form-group">
                  <button type="submit" class="btn btn-primary" style="width: 410px; margin-top: 10px;">Сохранить</button>
                </div>
              </form>
            {% elif user_application.status == "second" %}
              <form method="post" class="first_form" style="text-align: center; margin-top: 10px;">
                {% csrf_token %}
                {% for field in form %}
                  {{ field }}
                {% endfor %}
                <div class="form-group">
                  <button type="submit" class="btn btn-primary" style="width: 410px; margin-top: 10px;">Завершить собеседование</button>
                </div>
              </form>
            {% endif %}
          {% elif user_application.status == "third" %}
            <!-- <form method="post" class="checklist-form" style="text-align: center; margin-top: 10px;">
                {% csrf_token %}
                {% for form in formset %}
                    {{ form.as_p }}
                {% endfor %}
                <div class="form-group">
                    <button type="submit" class="btn btn-primary" style="width: 200px; margin-top: 10px;">Сохранить</button>
                </div>
            </form> -->
            <form method="post" class="checklist-form" style="text-align: center; margin-top: 10px;">
              {% csrf_token %}
              {{ formset.management_form }}
              <div id="input-container">
                  {% for form in formset %}
                      {{ form.as_p }}
                  {% endfor %}
              </div>
              <div class="form-group">
                  <button type="button" onclick="removeInputField()" class="btn btn-danger btn-sm" style="width: 30px; padding: 0;"><i class="fas fa-minus">-</i></button>
                  <button type="button" onclick="addInputField()" class="btn btn-success btn-sm" style="margin-right: 5px; width: 30px; padding: 0;"><i class="fas fa-plus">+</i></button>
              </div>
              <div class="form-group">
                  <button type="submit" class="btn btn-primary" style="width: 200px; margin-top: 10px;">Сохранить</button>
              </div>
            </form>
          
            <script>
              function addInputField() {
                  var container = document.getElementById("input-container");
                  var inputs = container.getElementsByTagName("input");
          
                  // Создаем копию первого поля для ввода
                  var clonedInput = inputs[0].cloneNode(true);
          
                  // Очищаем значение скопированного поля
                  clonedInput.value = "";
          
                  container.appendChild(clonedInput);
              }
          
              function removeInputField() {
                  var container = document.getElementById("input-container");
                  var inputs = container.getElementsByTagName("input");
                  if (inputs.length > 0) {
                      container.removeChild(inputs[inputs.length - 1]);
                  }
              }
          </script>
          {% else %}
              <p>Статус неизвестен</p>
          {% endif %}
        </div>
        
</div>
{% endblock %}