{% extends 'main/user/base.html' %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
{% load bootstrap4 %}
{% bootstrap_css %}
{% bootstrap_javascript %}
{% block application %}

<style>
  #map{
    position: relative;
    /* top: 200px;
    left: 100px; */
  }
</style>

<div class="template-div" >
    {% if user_application_len != 0 %}
        <!-- <button type="submit" class="btn btn-primary">создать заявку на релокацию</button> -->
        <br>
            <form method="post" action="{% url 'newUserApplication' %}">
            {% csrf_token %}
                <table class="table table-hover" style="width: 100%;">
                    <thead>
                        <tr>
                            <th>Выбор</th>
                            <th>Страна</th>
                            <th>Город</th>
                            <th>Описание</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for location in locations %}
                            <tr>
                                <td>
                                    <input type="radio" name="selected_location" value="{{ location.id }}" onclick="" onchange="updatePlacemark([{{location.latitude}}, {{location.longitude}}])">
                                </td>
                                <td>{{ location.country }}</td>
                                <td>{{ location.city }}</td>
                                <td>{{ location.description }}</td>
                                <!-- <td>{{ location.latitude }}</td>
                                <td>{{ location.longitude }}</td> -->
                            </tr>
                        {% endfor %}
                    </tbody>
                    <tbody>
                        
                    </tbody>
                </table>
                <button type="submit" class="btn btn-primary">Подтвердить</button>
            </form>
            
            <div id="map" style="width: 100%; height: 500px"></div>

            <script src="https://api-maps.yandex.ru/2.1/?apikey=1c863c16-81b2-4b8f-be71-2007755b1fca&lang=ru_RU" type="text/javascript"></script>        
            <script type="text/javascript">
              function updatePlacemark(coordinates) {
                console.log(coordinates);
                coordinates[0] += coordinates[1] / 100;
                coordinates[1] = coordinates[2] + coordinates[3] / 100;
                console.log(coordinates);
                placemark.geometry.setCoordinates(coordinates);
              }
                ymaps.ready(function () {
                    var myMap = new ymaps.Map('map', {
                            center: [53.90, 27.56],
                            zoom: 10
                        }, {
                            searchControlProvider: 'yandex#search'
                        });
                    var myPlacemark = new ymaps.Placemark([53.91, 27.56], {
                            hintContent: '{{ city.name }}',
                            balloonContent: '{{ city.description }}'
                        }, {
                            preset: 'islands#icon',
                            iconColor: '#0095b6'
                        });
                    window.placemark = myPlacemark;
                    myMap.geoObjects.add(myPlacemark);
                });
            </script>
    {% else %} 

    <style>
        h1 {
            position: absolute;
            top: 40%;
            left: 220;
            width: 100%;
        }
        .content-div{
        width: 1536px;
        height: 633px;
    
        .nav-item{
            margin-left: 160px;
            margin-right: 160px;
            margin-top: 15px;
            pointer-events: none;
        }
        .nav-link {
          border-radius: 50%;
          width: 45px;
          height: 45px;
          line-height: 30px;
          text-align: center;
        }
        .container{
          width: 2000px;
        }
        .progress {
        position: relative;
        }
    }
    </style>

    <div class="container">
		<div class="row">
		  <div class="col-md-12" >
			<ul class="nav nav-pills mb-3 justify-content-center" id="pills-tab" role="tablist">
			  <li class="nav-item" role="presentation">
				<a class="nav-link" id="pills-step1-tab" data-toggle="pill" href="#pills-step1" role="tab" aria-controls="pills-step1" aria-selected="true">1</a>
			  </li>
			  <li class="nav-item" role="presentation">
				<a class="nav-link" id="pills-step2-tab" data-toggle="pill" href="#pills-step2" role="tab" aria-controls="pills-step2" aria-selected="false">2</a>
			  </li>
			  <li class="nav-item" role="presentation">
				<a class="nav-link" id="pills-step3-tab" data-toggle="pill" href="#pills-step3" role="tab" aria-controls="pills-step3" aria-selected="false">3</a>
			  </li>
			</ul>
			<div class="progress mb-3">
			  <div class="progress-bar progress-bar-striped" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
			</div>
			<div class="tab-content" id="pills-tabContent">
			  <div class="tab-pane fade show active" id="pills-step1" role="tabpanel" aria-labelledby="pills-step1-tab">
				
			  </div>
			  <div class="tab-pane fade" id="pills-step2" role="tabpanel" aria-labelledby="pills-step2-tab">
				
			  </div>
			  <div class="tab-pane fade" id="pills-step3" role="tabpanel" aria-labelledby="pills-step3-tab">
				
			  </div>
			</div>
		  </div>
		</div>
    <p>1. Заявка отправлена</p>
    <p>2. Заявка отправлена</p>
    <p>3. Заявка отправлена</p>
	  </div>

    <script>
		document.addEventListener("DOMContentLoaded", function(event) {
		var status = "{{ status }}";
		var progressBar = document.querySelector(".progress-bar");
		
		if (status == "first") {
			progressBar.style.width = "33%";
			progressBar.setAttribute("aria-valuenow", "33" );
			document.querySelector("#pills-step1-tab").classList.add("active");
		} else if (status == "second") {
			progressBar.style.width = "66%";
			progressBar.setAttribute("aria-valuenow", "66");
			document.querySelector("#pills-step2-tab").classList.add("active");
		} else if (status == "third") {
			progressBar.style.width = "100%";
			progressBar.setAttribute("aria-valuenow", "100");
			document.querySelector("#pills-step3-tab").classList.add("active");
		}
		});
	  </script>
        <div>
          {% if user_application.status == "first" %}
            <h1>Ваша заявка отправлена, ожидайте ответа HR</h1>
          {% elif user_application.status == "second" %}
              <p>Второй</p>
          {% elif user_application.status == "third" %}
              <p>Третий</p>
          {% else %}
              <p>Статус неизвестен</p>
          {% endif %}
        </div>
    {% endif %}  
</div>

{% endblock %}